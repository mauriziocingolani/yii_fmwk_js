var Application={start:function(a){$.datepicker.setDefaults({closeText:"Chiudi",prevText:"Mese precedente",nextText:"Mese successivo",currentText:"Oggi",monthNames:["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"],monthNamesShort:["Gen","Feb","Mar","Apr","Mag","Giu","Lug","Ago","Set","Ott","Nov","Dic"],dayNames:["Domenica","Luned&#236","Marted&#236","Mercoled&#236","Gioved&#236","Venerd&#236","Sabato"],dayNamesShort:["Dom","Lun","Mar","Mer","Gio","Ven","Sab"],dayNamesMin:["Do","Lu","Ma","Me","Gio","Ve","Sa"],dateFormat:"dd/mm/yy",firstDay:1,changeMonth:true,changeYear:true,dayNames:["Lunedì","Martedì","Mercoledì","Giovedì","Venerdì","Sabato","Domenica"],showAnim:"slide",showButtonPanel:true,showOtherMonths:false,showWeek:true});$.datepicker.setDefaults($.datepicker.regional.it);if(a!==undefined){a()}$("[data-toggle='tooltip']").tooltip();$(document).on("change",".btn-file :file",function(){var b=$(this);b.trigger("fileselect",[b[0].files[0]])});$("#status").fadeOut(1500);$("#preloader").delay(500).fadeOut(1000);$("body").delay(1000).css({overflow:"visible"})},noDocumentDragAndDrop:function(){$(document).on("dragenter",function(a){a.stopPropagation();a.preventDefault()});$(document).on("dragover",function(a){a.stopPropagation();a.preventDefault()});$(document).on("drop",function(a){a.stopPropagation();a.preventDefault()})}};var Form=function(c,e,b){this.name=c;this.options=b;var a={};var d=this;$("#"+c+" .form-control, #"+c+" .form-control-static, #"+c+" .checkbox").each(function(){a[$(this).attr("id")]=new Field(d,$(this),e)});this.fields=a;this.message=$("#"+c+"_message")};Form.prototype.validate=function(){var b=true;var a;$.each(this.fields,$.proxy(function(c,d){a=d.validate();d.setErrorStatus(a);if(a!==true){b=false}},this));return b};Form.prototype.getField=function(a){return this.fields[this.name+"_"+a]};Form.prototype.getFieldValue=function(a){return this.getField(a).getValue()};Form.prototype.setFieldValue=function(b,a){this.getField(b).setValue(a)};Form.prototype.setFieldEvent=function(c,b,a){this.fields[this.name+"_"+c].field.on(b,a)};var Field=function(e,f,d){this.field=f;this.id=f.attr("id");this.div=$("#"+f.attr("id")+"_div");this.error=$("#"+f.attr("id")+"_error");this.errormessage=$("#"+f.attr("id")+"_errormessage");if(f.attr("data-required")){this.required=true}if(f.attr("data-regexp")){this.regexp=new RegExp(f.attr("data-regexp"))}if(f.attr("data-date")){this.field.datepicker();this.date=true}if(this.field.attr("data-time")){this.field.timepicker({hourText:"Ora",minuteText:"Minuto",nowButtonText:"Adesso",showNowButton:true,});this.time=new RegExp(f.attr("data-time"))}if(this.field.attr("data-combo-select")){this.combo=true;this.values=$("#"+this.id+"_data li");var a=new Array;for(var b=0,g=this.values.length;b<g;b++){a.push($(this.values[b]).html())}this.field.autocomplete({source:a,minLength:0,select:$.proxy(function(h,i){this.setErrorStatus(this.validate(i.item?i.item.label:""))},this),change:$.proxy(function(h,i){this.setErrorStatus(this.validate(i.item?i.item.label:""))},this)});$("#"+this.id+"_button").on("click",$.proxy(function(){this.field.autocomplete("search","");this.field.focus()},this));$("#"+this.id+"_data").remove()}if(this.field.attr("data-number")){this.number=this.field.attr("data-number");this.min=this.field.attr("data-min")!=undefined&&this.field.attr("data-min").length>0?(this.number=="int"?parseInt(this.field.attr("data-min"),10):parseFloat(this.field.attr("data-min"))):null;this.minMessage=this.field.attr("data-min-message");this.max=this.field.attr("data-max")!=undefined&&this.field.attr("data-max").length>0?(this.number=="int"?parseInt(this.field.attr("data-max"),10):parseFloat(this.field.attr("data-max"))):null;this.maxMessage=this.field.attr("data-max-message")}if(this.field.attr("data-compare")){this.form=e;this.compare=this.field.attr("data-compare");this.compareOperator=this.field.attr("data-compare-operator");this.compareMessage=this.field.attr("data-compare-message")}if(this.field.attr("data-uppercase")||this.field.attr("data-lowercase")||this.field.attr("data-propercase")||this.field.attr("data-trim")){this.field.on("blur",$.proxy(function(i){var h=$("#"+i.target.id);var j=h.val();if(this.field.attr("data-uppercase")){j=j.toUpperCase()}if(this.field.attr("data-lowercase")){j=j.toLowerCase()}if(this.field.attr("data-propercase")){j=j.toProperCase()}if(this.field.attr("data-trim")){j=j.trim()}h.val(j);h=null},this))}if(this.field.attr("data-sn-editor")){var c=e.options==undefined?{}:(e.options.sn||{});if(d){c.onblur=$.proxy(function(){this.setErrorStatus(this.validate())},this)}this.sn=this.field.summernote(c)}if(d){if(!this.field.attr("data-sn-editor")){f.on("change",$.proxy(function(){this.setErrorStatus(this.validate())},this))}}};Field.prototype.validate=function(c){if(c===undefined){c=this.getValue()}if(this.required&&(c.length<=0||(this.field.attr("type")=="checkbox"&&c===0))){return this.field.attr("data-missing-message")}if(this.regexp&&c.length>0&&!this.regexp.test(c)){return this.field.attr("data-invalid-message")}if(this.date){if(!this.validateDate(c,this.field.datepicker("getDate"),this.required)){return this.field.attr("data-invalid-message")}}if(this.time&&c.length>0&&!this.time.test(c)){return this.field.attr("data-invalid-message")}if(this.number){var a=this.number=="int"?parseInt(c,10):parseFloat(c);if(this.min!==null&&a<this.min){return this.minMessage||this.field.attr("data-invalid-message")}if(this.max!==null&&a>this.max){return this.maxMessage||this.field.attr("data-invalid-message")}}if(this.compare){var b;if(this.date){c=this.field.datepicker("getDate");b=this.form.getField(this.compare).field.datepicker("getDate")}else{if(this.number){b=this.number=="int"?parseInt(this.form.getFieldValue(this.compare),10):parseFloat(this.form.getFieldValue(this.compare))}else{b=this.form.getFieldValue(this.compare)}}if(c){switch(this.compareOperator){case"=":case"==":return c==b?true:this.compareMessage;case"!=":return c!=b?true:this.compareMessage;case">":return c>b?true:this.compareMessage;case">=":return c>=b?true:this.compareMessage;case"<":return c<b?true:this.compareMessage;case"<=":return c<=b?true:this.compareMessage}return this.compareMessage}return true}return true};Field.prototype.setErrorStatus=function(a){if(a!==undefined&&a.length>0){this.div.addClass("has-error");this.errormessage.text(a);this.error.show()}else{this.div.removeClass("has-error");this.error.hide()}};Field.prototype.getValue=function(){if(this.field.attr("type")=="checkbox"){return this.field.is(":checked")?1:0}else{if(this.field.attr("data-sn-editor")){return this.field.code()!="<p><br></p>"?this.field.code():""}else{return this.field.val()}}};Field.prototype.setValue=function(a){this.field.val(a)};Field.prototype.validateDate=function(e,b,h){if((e==null||e==="")&&(h==undefined||h===false)){return true}if(!/^[0-9]{2}\/[0-9]{2}\/[0-9]{4}$/g.test(e.toString())){return false}var a=e.substring(0,2);var f=parseInt(e.substring(3,5),10)-1;var c=e.substring(6,10);var g=new Date(c,f,a);return g.getTime()===b.getTime()};var AjaxRequest=function(b,d,a,f,e){if(b===undefined||d===undefined||e===undefined){throw"AjaxRequest constructor -  undefined parameter: controller, action or params"}var c="/"+b+"/"+d;if(f!==undefined&&f!==null){if(f instanceof Object){ModalDialog.show(f.title,f.message)}else{ModalDialog.show(f,"Attendere prego...")}}if(a!==undefined&&a!==null){if(typeof a==="string"){a=$("#"+a)}a.removeClass("warning").removeClass("success").hide()}$.ajax({url:c,type:e.method||"POST",dataType:"json",data:e.params,success:$.proxy(function(g){if(f!==undefined&&f!==null){ModalDialog.hide()}e.onSuccess(g,a)},this),error:$.proxy(function(h,i,g){if(f!==undefined&&f!==null){ModalDialog.hide()}if(e.onError){e.onError(h,a)}else{if(a!==undefined&&a!==null){Message.showAjaxError(a,h)}}},this)})};var Message={show:function(f,d,c,b,a){var e=typeof f==="string"?$("#"+f):f;e.html(d+(b?" Error "+b.status+" "+b.statusText:""));e.addClass(c?"alert-danger":"alert-success");e.removeClass(c?"alert-success":"alert-danger");e.fadeIn("slow",function(){if(a){a()}})},showAjaxError:function(d,c,a){var b=typeof d==="string"?$("#"+d):d;b.html("ERRORE AJAX. Error "+c.status+" "+c.statusText+(c.responseText.length>0?" : <em>"+c.responseText+"</em>":""));b.addClass("alert-danger");b.removeClass("alert-success");b.fadeIn("slow",function(){if(a){a()}})},showOverJson:function(e,c,a,b){var d=typeof e==="string"?$("#"+e):e;d.html(c.message);d.addClass(c.error?"alert-danger":"alert-success");d.removeClass(c.error?"alert-success":"alert-danger");d.fadeIn("slow",function(){if(!c.error&&a){a()}else{if(c.error&&b){b()}}})}};var ModalDialog={div:null,title:null,content:null,init:function(){if(this.div===null){this.div=$("#main-modal");this.title=$("#main-modal-title");this.content=$("#main-modal-content");this.div.modal({backdrop:"static",keyboard:false})}},show:function(b,a){this.init();this.title.html(b);this.content.html(a?a:b+". Attendere prego...");this.div.modal("show")},hide:function(){this.div.modal("hide")}};var PictureDragAndDropHandler=function(d,a,b,c){this.div=typeof d=="string"?$("#"+d):d;this.controller=a;this.action=b;this.params=c;this.span=$("#"+d.attr("id")+"_span");this.label=$("#"+d.attr("id")+"_label");this.img=$("#"+d.attr("id")+"_img");this.clear=$("#"+d.attr("id")+"_clear");this.clear.click($.proxy(function(){this.img.attr("src",null);this.img.hide();this.label.html(null);this.label.hide();this.span.show();this.clear.hide()},this));$("#"+d.attr("id")+" .btn-file :file").on("fileselect",$.proxy(function(f,e){this.transfer(e)},this));if(c.message){this.message=typeof c.message=="string"?$("#"+c.message):c.message}this.initDnd()};PictureDragAndDropHandler.prototype.initDnd=function(){this.div.on("dragenter",$.proxy(function(a){a.stopPropagation();a.preventDefault();this.div.addClass("drop")},this));this.div.on("dragleave",$.proxy(function(a){a.stopPropagation();a.preventDefault();this.div.removeClass("drop")},this));this.div.on("dragover",$.proxy(function(a){a.stopPropagation();a.preventDefault()},this));this.div.on("drop",$.proxy(function(b){this.div.removeClass("drop");b.preventDefault();var a=b.originalEvent.dataTransfer.files;if(a.length==1){this.transfer(a[0])}},this))};PictureDragAndDropHandler.prototype.transfer=function(b){var a=new FormData;a.append("file",b);if(this.params.path){a.append("path",this.params.path)}ModalDialog.show('<div id="progressbar"></div>',this.params.dialogMessage?this.params.dialogMessage:"Caricamento file");if(this.params.beforeTransferStart){this.params.beforeTransferStart()}var c=$("#progressbar");c.progressbar();$.ajax({xhr:function(){var d=$.ajaxSettings.xhr();if(d.upload){d.upload.addEventListener("progress",function(h){var g=0;var e=h.loaded||h.position;var f=h.total;if(h.lengthComputable){g=Math.ceil(e/f*100)}c.progressbar("value",g)},false)}return d},url:"/"+this.controller+"/"+this.action,type:"POST",contentType:false,processData:false,cache:false,data:a,dataType:"json",success:$.proxy(function(d){if(this.img){this.img.attr("src",d.data);this.img.show()}if(this.label){this.label.text(d.data);this.label.show()}this.span.hide();this.clear.show();ModalDialog.hide();if(this.params.onSuccess){this.params.onSuccess(d,this.message)}},this),error:$.proxy(function(d){ModalDialog.hide();if(this.params.error){this.params.error(d,this.message)}},this)})};PictureDragAndDropHandler.prototype.getImgPath=function(){return this.img.attr("src")};PictureDragAndDropHandler.prototype.getFilePath=function(){return this.label.text()};String.prototype.toProperCase=function(){var a=/^(zjfhjd?\.?|via)$/i;return this.replace(/[A-Za-z0-9\u00C0-\u00FF]+[^\s-']*/g,function(c,b,d){if(b>0&&b+c.length!==d.length&&c.search(a)>-1&&d.charAt(b-2)!==":"&&(d.charAt(b+c.length)!=="-"||d.charAt(b-1)==="-")&&d.charAt(b-1).search(/[^\s-]/)<0){return c.toLowerCase()}if(c.substr(1).search(/[A-Z]|\../)>-1){return c}return c.charAt(0).toUpperCase()+c.substr(1)})};String.prototype.textBeforeFirstUnderscore=function(){return this.substring(0,this.indexOf("_"))};